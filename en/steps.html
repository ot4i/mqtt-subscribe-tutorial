
<!DOCTYPE html>
<html class="no-js" lang="en">
 
	
<!-- header::Start -->
	<head>
		<!-- Use Internet Explorer 9 Standards mode for Eclipse Browser Control - https://www.eclipse.org/swt/faq.php#browsernativeie and https://msdn.microsoft.com/en-us/library/jj676915%28v=vs.85%29.aspx -->
  		<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
		
		<!-- Next 2 http=equiv headers required to disable caching the Eclipse Browser Widget -->
		<meta http-equiv="Pragma" content="no-cache">
  		<meta http-equiv="Expires" content="-1">

		<meta charset="UTF-8"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<meta name="copyright" content="Copyright IBM Corporation 2014" />
		<meta name="abstract" content="IBM Integration Bus V10 Tutorial">
		<meta name="author" content="IBM">
		<meta name="description" content="IBM Integration Bus V10 Tutorial">
		<meta name="keywords" content="keywords" > 
		<meta name="robots" content="index,follow">
		<meta name="source" content="IBM Integration Bus V10 Tutorial" /> 
		
		<title>IBM Integration Bus V10 Tutorial</title>

    	<link rel="stylesheet" href="http://ot4i.github.io/iib-tutorials/css/main.css" />
		<link rel="stylesheet" href="http://ot4i.github.io/iib-tutorials/css/app.css" />
    	
		<script src="http://ot4i.github.io/iib-tutorials/js/json2.js"></script>
		<script src="http://ot4i.github.io/iib-tutorials/js/js2java.js"></script>
		<script src="http://ot4i.github.io/iib-tutorials/js/js2java_steps.js"></script>
		<script src="http://ot4i.github.io/iib-tutorials/js/vendor/modernizr.js"></script>
	</head>
<!-- header::End -->
<!-- body::Start -->
		<body>
  	<!-- body content here -->
	<div class="row">
	  <div class="small-12 medium-12 large-12 columns">
	    <p> </p>
	  </div>
	</div>
	<div class="row">
	  <div class="small-9 medium-9 large-9 columns">
	    <h4 class="title">Subscribing to receive MQTT events <action><div class="small radius button" id="stepsViewDetails" onclick="viewDetails()"> Back to Overview</div> </action></h4>
	  </div>
	  <div class="small-3 medium-3 large-3 columns">
		<a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.msgbroker.helphome.doc/help_home_msgbroker.htm')" class="small right helplink">IBM Knowledge Center</a> 
	  </div>
	</div> 
	<hr>
	<div class="row">
		<div class="small-10 medium-10 large-10 columns">
		<h5> Learn how to use the MQTT Subscribe node to receive data from an MQTT broker. </h5>
		</div>
		<div class="small-2 medium-2 large-2 columns">
			<div class="small radius button right" id="backToGallery" onclick="backToGallery()"> Back To Gallery
			</div>
		</div>
	</div>
	<div class="row">          
		  <div class="small-12 medium-12 large-12 columns">
			<ul class="tabs vertical"> 
				<li class="tab-title tab-title-small active">
				  <a href="javascript:;" onclick="show('panel21')">Create</a> 
				</li>
				<li class="tab-title tab-title-small">
				  <a href="javascript:;" onclick="show('panel31')">Prepare</a> 
				</li>
				<li class="tab-title tab-title-small">
				  <a href="javascript:;" onclick="show('panel41')">Run</a> 
				</li>
			</ul>
			<!-- editing -->
			<div class="tabs-content panel-thin-blue vertical"> 
		    	<div class="content active" id="panel21">
		    		
		    		<div class="small-10 medium-10 large-10 columns divider">
					
				      	<div class="row content-details">
					      	<h4>Create the message flow and the device</h4>
					        
						    
								<p> Create a device that is connected to IoT Foundation and will publish data on a topic that the message flow can subscribe to. </p>
								
								
									
									<ol>
									
									
										<li> On your smartphone/tablet/computer, start the simulator by browsing to <a href="http://quickstart.internetofthings.ibmcloud.com/iotsensor" target="_blank">http://quickstart.internetofthings.ibmcloud.com/iotsensor</a>. The simulator connects automatically and starts publishing data. Keep your simulator window active and in the foreground.
										
										</li>
									
										<li> Take a note of the MAC address of the device. This is seen in the top right of the device screen. You will need this to complete the configuration of the message flow.
										
										</li>
									
									
									</ol>
									
								
							
								<p> Import and complete the configuration of the message flow. </p>
								
								
									
									<ol>
									
									
										<li> Click the <span class="uicontrol">Import</span> button on the right of this view and the MQTTSubscribe application which includes a partially complete Message flow will be imported into your workspace.
										
										</li>
									
										<li> The <span class="uicontrol">MQTTSubscribe</span> message flow should be open in the Message Flow editor. If not, locate it under the flows section of the <span class="application">MQTTSubscribe</span> application and double click to open it for editing.
										
										</li>
									
										<li> Select the MQTTSubscribe node in the message flow and look at the <span class="uicontrol">Properties</span> view
										
										
											
											<ul>
											
												
													<li> <b>Tip:</b> To allow you to see the properties view and the tutorial steps at the same time, move this current view to the right hand side of the message flow editor by dragging and dropping the tab at the top of this view, where you see the title <span class="�uicontrol�">Tutorial Steps View</span>.</li>
												
											
											</ul>
											
										
										</li>
									
										<li> Some of the properties have already been configured with values. The <span class="�parmname�">Host name</span> and  <span class="�parmname�">Port</span> are configured to connect to the IoT Foundation MQTT broker that is hosted on the internet.
										
										</li>
									
										<li> The <span class="parmname">Client ID</span> property is blank and must be configured with a valid value. Enter the value <span class="userinput">a:quickstart:&lt;unique-name&gt;</span> where <span class="userinput">&lt;unique-name&gt;</span> is a value that you can chose and is unlikely to be chosen by anyone else. For example, choosing my name and birth year to avoid clashing with other people, I would enter <span class="userinput">a:quickstart:hosie75</span>.
										
										
											
											<ul>
											
												
													<li> <b>You might like to know:</b> In the MQTT protocol, the client id is used to uniquely identify a device or an instance of an application that is connected to an MQTT broker. Each device and application must specify a different client id. In any particular instance of an MQTT broker, there may be a certain convention to follow when choosing the client id. In the case of IBM IoT Foundation quickstart, the convention is that applications must specify a client id with the form <span class="code">a:quickstart:&lt;unique-name&gt;</span> where <span class="code">&lt;unique-name&gt</span> is a value chose by the application to be unique across all applications connecting to the quickstart service. This convention must be followed otherwise the application will fail to connect to the IoT Foundation.</li>
												
											
											</ul>
											
										
										</li>
									
										<li> The <span class="parmname">Topic name</span> property is blank and must be configured with a valid value. Enter the value  <span class="userinput">iot-2/type/+/id/&lt;deviceid&gt;/evt/+/fmt/+</span> where <span class="userinput">&lt;deviceid&gt;</span> is the MAC address of the device, that you simulated in the earlier step, with colons removed and all letters in lower case. For example, if the MAC Address of your device is C2:AC:80:42:DA:D7 then the Topic name must be entered as <span class="userinput">iot-2/type/+/id/c2ac8042dad7/evt/+/fmt/+</span>.
										
										
											
											<ul>
											
												
													<li> <b>You might like to know:</b> When data is published over MQTT, they are published on a particular topic. The topic string is hierarchical and is normally used to indicate some categorisation of the data that is meaningful in the particular domain. Receiving applications subscribe to particular topics and can use wildcards to subscribe to many topics with a single topic string. In the case of IoT Foundation quickstart, the topic name includes the id of the device that published the data. Subscribing applications must specify the device id explicitly although wildcard (<span class="code">+</span>) may be used elsewhere in the topic string, as we have done in this tutorial.</li>
												
											
											</ul>
											
										
										</li>
									
										<li> Save the message flow.
										
										</li>
									
										<li> Ensure that there no errors associated with the message flow.
										
										</li>
									
									
									</ol>
									
								
							
						</div>
						
						<div class="row content-details">
							<h4>Find out more</h4>
							<ul>
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('http://mqtt.org/')" title="MQTT.ORG Information about the MQTT open standard">Information about the MQTT open standard</a> </li>
									
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/bc62000_.htm')" title="Knowledge Center link to Processing MQTT messages in IBM Integration Bus">Processing MQTT messages in IBM Integration Bus</a> </li>
							   	
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/bc46000_.htm')" title="Knowledge Center link to MQTTSubscribe node">MQTTSubscribe node</a> </li>
							   	
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('https://internetofthings.ibmcloud.com/#/')" title="IBM Internet of Things Foundation IBM Internet of Things Foundation">IBM Internet of Things Foundation</a> </li>
									
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('https://developer.ibm.com/iot/recipes/application-development-quickstart/')" title="IBM Internet of Things Foundation Connecting applications to IoT Foundation quickstart">Connecting applications to IoT Foundation quickstart</a> </li>
									
							
								
								
								<li> <a href="javascript:;" onclick="openExternalBrowser('https://developer.ibm.com/iot/recipes/simulator/')" title="IBM Internet of Things Foundation Device simulator for IoT Foundation quickstart">Device simulator for IoT Foundation quickstart</a> </li>
									
							
							</ul>
						</div>
						
					</div>
					
					<div class="small-2 medium-2 large-2 columns">
					
					
					<h4 class="tkaction"><a href="javascript:;" onclick="importArtifacts(); openResource('MQTTSubscribe')"> Import <img class="icon-image" src="http://ot4i.github.io/iib-tutorials/images/icons/ibmdesign/back-right-previous_128-orange.png"></a></h4>
										
				    </div>
					
		    	</div>
		    	<div class="content" id="panel31">
					
					<div class="small-12 medium-12 large-12 columns">
					
						<div class="row content-details">
						  	<h4>Deploy Application</h4>
						    
						    
								<p> Before deploying the application, we must make sure that the file system is ready for the data to be written to the output file by the message flow. </p>
								
							
								<p> The file output node is configured to write the data to a file in the output directory <span class="userinput">C:\fileout</span> </p>
								
								
									
									<ul>
									
									
										<li> Create the output directory <span class="userinput">C:\fileout</span> on your local file system or change the <span class="parmname">Directory</span> property of the FileOutput node to a directory that exists and your current user id has write access.
										
										
											
											<ul>
											
												
													<li> If you are using Linux, then you will probably need to change the <span class="parmname">Directory</span> property.</li>
												
											
											</ul>
											
										
										</li>
									
									
									</ul>
									
								
							
								<p> Once you have completed these steps, drag the <span class="application">MQTTSubscribe</span> application from the <span class="uicontroll">Application Development</span> view and drop it on an integration server in the <span class="uicontroll">Integration Nodes</span> view. The application will be deployed to the integration server and the message flow will connect to the IoT Foundation, ready to receive the data published by your device. </p>
								
								
									
									<ul>
									
									
										<li> If you have a firewall on your computer, you might be asked to allow the <span class="code">DataFlowEngine.exe</span> process to connect to <span class="code">quickstart.messaging.internetofthings.ibmcloud.com</span>. If you do not allow this connection, then the message flow will fail to connect to the IoT Foundation and you will not be able to complete this tutorial.
										
										</li>
									
									
									</ul>
									
								
							
						</div>
						
						<div class="row content-details">
							<h4>Find out more</h4>
							<ul>
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/ac55170_.htm')" title="Knowledge Center link to Working with files">Working with files</a> </li>
							   	
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/aa40160_')" title="Knowledge Center link to How to deploy and test message flows">How to deploy and test message flows</a> </li>
							   	
							
							</ul>
						</div>
							
					</div>
					
		    	</div>
		    	<div class="content" id="panel41">
		    		
		    		<div class="small-10 medium-10 large-10 columns divider">
					
				    	<div class="row content-details">
					      	<h4>Follow these steps to complete the tutorial</h4>
					        
						    
								<p> The message flow will immediately start receiving data, that is published by the device simulator that you launched in the <span class="uicontrol">Create</span> step, and will write that data to a file in the directory that you created in the <span class="uicontrol">Prepare</span> step. </p>
								
							
								<p> Change some of the metrics (temperature/humidity) on the device simulator and open the output file again to see new events with those values appended at the end of the file. </p>
								
							
								<p> In addition to this, you can use the flow exerciser to inspect other information, about the publication, that is available in the message flow </p>
								
								
									
									<ol>
									
									
										<li> Open the MQTTSubscribe message flow, and click the Flow Exerciser icon <img src="http://ot4i.github.io/ot4i.tutorials//dist/images/icons/iib/startFlowExerciser.png" alt> to start recording the message path through the flow.
										
										
											
											<ul>
											
												
													<li> <b>Take care:</b> If you have more than one Integration Server available, then you will be presented with a choice of which integration server to use to record this message flow.  Make sure that you chose the same one that you deployed to in the <span class="�uicontrol�">Prepare</span> otherwise, you will have 2 separate instances of the message flow trying to connect to the MQTT broker with the same client id and that will cause errors.</li>
												
											
											</ul>
											
										
										</li>
									
										<li> Wait a few seconds to ensure that, at least one, event is published.
										
										</li>
									
										<li> In the Flow Exerciser toolbar, click the View Path icon <img src="http://ot4i.github.io/iib-tutorials/images/icons/iib/viewPath.png" alt="View path"> to highlight the message path through the message flow. Click on the connection to see the message data that passed between the MQTTSubscribe node and the FileOutput node.
										
										</li>
									
										<li> In the <span class="code">Message</span> tree, you will see the <span class="code">Properties</span> folder followed by a <span class="code">JSON</span> folder that shows the same data that was written to the output file.
										
										
											
											<ul>
											
												
													<li> NOTE: the data is formatted as XML by the UI for the purpose of rendering it through the flow exerciser but in reality, it remains as JSON as passes from IoT foundation, through the message flow and into the output file.</li>
												
											
											</ul>
											
										
										</li>
									
										<li> Expand the <span class="code">LocalEnvironment</span> folder and you will see extra information about the publication. It would be possible to add other nodes to the message flow that could process this information or even copy it to the output file.
										
										</li>
									
										<li> Click the <span class="uicontrol">Clean Up</span> button at the top right of this page.  If you do not do this then the message flow will continue to append data to the output file.
										
										</li>
									
									
									</ol>
									
								
							
						</div>
						
						<div class="row content-details"> 	
							<h4>Find out more</h4>
							<ul>
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/bc62011_.htm')" title="Knowledge Center link to Using local environment variables with MQTT nodes">Using local environment variables with MQTT nodes</a> </li>
							   	
							
								
																
								<li> <a href="javascript:;" onclick="openHelpSystem('/com.ibm.etools.mft.doc/rt26110_.htm')" title="Knowledge Center link to Testing your message flow by using the Flow exerciser">Testing your message flow by using the Flow exerciser</a> </li>
							   	
							
							</ul>
						</div>
							
					</div>
					
					<div class="small-2 medium-2 large-2 columns">
					
					
					
					
					
					<h4 class="tkaction"><a href="javascript:;" onclick="cleanUp()" title="Clean up and remove any changes in your workspace made by the tutorial."> Clean Up <img class="icon-image" src="http://ot4i.github.io/iib-tutorials/images/icons/ibmdesign/close-cancel-error_128-red.png"></a></h4>
				    
					
				    </div>
					
				</div>	
			</div> <!-- tab-content -->
		</div> <!-- columns -->
	  </div> <!-- row --></body>
		<script src="http://ot4i.github.io/iib-tutorials/js/vendor/jquery.js"></script>
		<script src="http://ot4i.github.io/iib-tutorials/js/vendor/foundation.min.js"></script>
		<script src="http://ot4i.github.io/iib-tutorials/js/main.js"></script>
	</body>
<!-- body::End -->

</html>
